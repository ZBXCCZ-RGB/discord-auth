<!DOCTYPE html>
<html>
<head>
    <title>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è GTA Server</title>
    <script>
    // –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–µ—Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const PUBLIC_CONFIG = {
        clientId: '1462119814339362816',
        redirectUri: window.location.origin + window.location.pathname,
        proxyUrl: 'https://–í–ê–®-PROXY.herokuapp.com' // –°—é–¥–∞ –ø–æ–∑–∂–µ –≤—Å—Ç–∞–≤–∏—Ç–µ
    };

    const urlParams = new URLSearchParams(window.location.search);
    const authCode = urlParams.get('code');

    if (authCode) {
        document.getElementById('step1').classList.add('hidden');
        document.getElementById('step2').classList.remove('hidden');
        
        processAuth(authCode);
    } else {
        document.getElementById('loginBtn').onclick = () => {
            const authUrl = `https://discord.com/oauth2/authorize?client_id=${PUBLIC_CONFIG.clientId}&redirect_uri=${encodeURIComponent(PUBLIC_CONFIG.redirectUri)}&response_type=code&scope=identify`;
            window.location.href = authUrl;
        };
    }

    async function processAuth(code) {
        try {
            // 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–¥ –Ω–∞ proxy-—Å–µ—Ä–≤–µ—Ä
            document.getElementById('status').textContent = 'üîê –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Discord...';
            
            const response = await fetch(`${PUBLIC_CONFIG.proxyUrl}/auth`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code, redirectUri: PUBLIC_CONFIG.redirectUri })
            });
            
            const data = await response.json();
            
            if (data.success) {
                // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                document.getElementById('status').textContent = '‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!';
                document.getElementById('userInfo').innerHTML = `
                    <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <strong>${data.user.username}</strong>!</p>
                    <p>Discord ID: ${data.user.id}</p>
                    ${data.addedToServer ? '<p>‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä Discord</p>' : ''}
                `;
                
                // 3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–ø—É—Å–∫–∞
                document.getElementById('continueBtn').onclick = () => {
                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ –ª–∞—É–Ω—á–µ—Ä
                    window.location.href = `my-launcher://auth?token=${data.gameToken}&discord_id=${data.user.id}`;
                };
                
            } else {
                document.getElementById('status').textContent = '‚ùå –û—à–∏–±–∫–∞: ' + data.error;
            }
            
        } catch (error) {
            document.getElementById('status').textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
            console.error(error);
        }
    }
</script>
</body>
</html>
